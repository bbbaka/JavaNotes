# 1. 基础知识
- 计算机的执行过程：取指(PC)执行

## 1.1 x86 PC开机过程
- 刚开机时CPU处于实模式(和保护模型对应，实模式的CS:IP和保护模式不一样)
- 开机： `CS=0xFFFF, IP=0x0000` (CS是x86的**代码段寄存器**，IP是**指令指针寄存器**，CPU会从`CS<<4+IP`的内存地址开始读取指令并执行)
- 寻址`0xFFFF0`（ROM BIOS映射区）
- 检查RAM，键盘，显示器，软硬磁盘
- 将磁盘0磁道0扇区（操作系统的引导扇区，512B）读入`0x7c00`处（0x7c00处存放的语句是 `mov ax, #BOOTSEG   mov ds, ax`，其中BOOTSEG=0x07c0）
- 设置`CS=0x07c0，IP=0x0000`（CS<<4+IP=0x7c00）


## 1.2 操作系统的接口
### 1.2.1 系统调用
- **操作系统的接口**表现为函数调用，又由系统提供，所以成为**系统调用(System Call)**

POSIX(IEEE的标准)定义的接口
- 任务管理
  - `fork`：创建一个进程
  - `excel`：运行一个可执行程序
  - `pthread_create`：创建一个线程
- 文件系统
  - `open`：打开一个文件或目录
  - `EACCES`：返回值，表示没有权限
  - `mode_t st_mode`：文件头结构：文件属性

### 1.2.2 系统调用的实现
- 用户不能随意调用内核数据，不能随意jmp
- 处理器的硬件隔离设计：通过**内核态和用户态**将内核程序和应用程序隔离，CS:IP是当前指令，用**CS的最低两位来区分内核态和用户态**：0是内核态，3是用户态
- 内核态可以访问任何数据，用户态不可以访问内核数据(通过比较CPL和DPL)
- 硬件提供了主动进入内核的方法：**中断指令int**，**int指令(int 0x80)将CS中的CPL修改为0，进入内核**，这是用户程序发起的调用内核代码的唯一方式，系统做中断处理，操作系统根据程序编号执行相应的代码

